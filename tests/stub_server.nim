import json
import shared / [ user ]
import nimx.timer
import falconserver.map.building.builditem
import falconserver.common.currency
import core.net.server
type
    StubServer* = ref object of Server

const LOGIN_JSON = staticRead("tests/login.json")
method login*(s: StubServer, handler: proc(r: JsonNode) = nil) =
    let jr = parseJson(LOGIN_JSON)
    jr["bucks"] = %0
    jr["chips"] = %127000
    jr["parts"] = %2900

    let u = currentUser()
    u.sessionId = jr["sessionId"].str
    u.chips = jr["chips"].num
    u.bucks = jr["bucks"].num
    u.parts = jr["parts"].num

    if "boosterRates" in jr:
        let rates = jr["boosterRates"]
        u.boostRates.xp = rates["exp"].getFloat()
        u.boostRates.inc = rates["inc"].getFloat()
        u.boostRates.tp = rates["tp"].getFloat()

    if not handler.isNil: handler(jr)

method getCheatsConfig*(s: StubServer, handler: proc (r: JsonNode) = nil) =
    if not handler.isNil: handler(newJNull())

method sendCheatRequest*(s: StubServer, req: string, data: JsonNode, handler: proc (r: JsonNode) = nil) =
    if not handler.isNil: handler(newJNull())

var spinNum = 0

method spin*(s: StubServer, bet:int64, lines: int, slotMachineId: string, mode: JsonNode, data: JsonNode, handler: proc(r: JsonNode)) =
    if slotMachineId == $dreamTowerSlot:
        let regularSpin = """{"chips":102000,"fc":0,"stages":[{"stage":"Spin","field":[7,0,1,5,8,0,8,9,4,5,10,7,11,9,11],"lines":[{"index":5,"symbols":2,"payout":500},{"index":9,"symbols":4,"payout":2500}],"jackpot":false}],"quests":{},"lvlData":{"level":1,"xpCur":10,"xpTot":1000},"maxBet":2,"serverTime":1480605266.690914}"""
        let bonusSpin = """{"chips":143450,"fc":0,"stages":[{"stage":"Spin","field":[8,8,3,2,7,5,2,11,10,11,11,3,2,4,0],"lines":[],"jackpot":false},{"stage":"Bonus","field":[3,4,5,1,6,7,2,0],"payout":43200}],"quests":{},"lvlData":{"level":1,"xpCur":50,"xpTot":1000},"maxBet":2,"serverTime":1480613472.479436}"""
        let freeSpinIntro = """{"chips":99000,"fc":7,"stages":[{"stage":"Spin","field":[1,1,3,9,5,11,11,5,0,9,4,8,8,1,6],"lines":[],"jackpot":false}],"quests":{},"lvlData":{"level":1,"xpCur":10,"xpTot":1000},"maxBet":2,"serverTime":1480677478.752179}"""
        let freeSpinOutro = """{"chips":124050,"fc":1,"stages":[{"stage":"FreeSpin","field":[5,7,8,4,5,7,5,0,8,0,8,4,4,7,8],"lines":[{"index":3,"symbols":2,"payout":100},{"index":9,"symbols":5,"payout":1000},{"index":11,"symbols":3,"payout":1250},{"index":13,"symbols":2,"payout":100}],"jackpot":false,"ftw":25050}],"quests":{},"lvlData":{"level":1,"xpCur":80,"xpTot":1000},"maxBet":2,"serverTime":1480677614.10153}"""
        let spinsRes = @[regularSpin, bonusSpin, freeSpinIntro, freeSpinOutro]

        setTimeout 0.5, proc() =
            handler(parseJson(spinsRes[spinNum])) # Win
            inc spinNum
            if spinNum >= spinsRes.len:
                spinNum = 0
    elif slotMachineId == $balloonSlot:
        setTimeout 0.5, proc() =
            var spins = [
                        """{"freeSpinsCount":0,"chips":115240,"stages":[{"stage":"Spin","field":[7,9,7,2,4,5,7,8,8,7,4,4,2,5,3],"lines":[{"index":9,"symbols":3,"payout":2000}],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2190,"xpTot":2600},"maxBet":6,"serverTime":1480527900.338618}""",
                        """{"freeSpinsCount":0,"chips":125240,"stages":[{"stage":"Respin","field":[5,9,8,2,4,4,4,2,8,7,8,5,4,5,3],"lines":[{"index":16,"symbols":3,"payout":10000}],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2220,"xpTot":2600},"maxBet":6,"serverTime":1480527901.150019}""",
                        """{"freeSpinsCount":0,"chips":126840,"stages":[{"stage":"Respin","field":[5,9,8,2,4,8,5,2,8,7,3,8,8,5,3],"lines":[{"index":8,"symbols":3,"payout":800},{"index":24,"symbols":3,"payout":800}],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2250,"xpTot":2600},"maxBet":6,"serverTime":1480527901.865983}""",
                        """{"freeSpinsCount":0,"chips":139640,"stages":[{"stage":"Respin","field":[5,9,2,2,4,3,5,9,8,7,0,3,5,5,3],"lines":[{"index":3,"symbols":3,"payout":6000},{"index":10,"symbols":3,"payout":6000},{"index":21,"symbols":3,"payout":800}],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2280,"xpTot":2600},"maxBet":6,"serverTime":1480527902.916778}""",
                        """{"freeSpinsCount":0,"chips":140440,"stages":[{"stage":"Respin","field":[3,3,2,2,4,9,9,4,8,7,6,7,0,5,3],"lines":[{"index":16,"symbols":3,"payout":800}],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2310,"xpTot":2600},"maxBet":6,"serverTime":1480527908.997754}""",
                        """{"freeSpinsCount":4,"chips":208040,"stages":[{"stage":"Bonus","field":[0,3,5,3,3,5,1,5,1,5,1,7,9,6,8,8,4,8,4,7,8,5,6,7,5],"rockets":[{"6":{"0":[-1,0,0]}},{"8":{"0":[1,4,16000],"1":[16,4,16000],"2":[15,4,6000],"3":[9,4,12000]}},{"10":{"0":[17,3,800],"1":[20,3,800],"2":[12,3,800],"3":[18,3,10000],"4":[20,4,6000]}}],"payout":67600}],"quests":{},"lvlData":{"level":5,"xpCur":2370,"xpTot":2600},"maxBet":6,"serverTime":1480527923.551577}""",
                        """{"freeSpinsCount":4,"chips":232040,"stages":[{"stage":"FreeSpin","field":[5,7,5,6,8,8,5,6,7,7,5,7,5,8,5],"lines":[{"index":3,"symbols":3,"payout":6000},{"index":4,"symbols":3,"payout":6000},{"index":9,"symbols":3,"payout":6000},{"index":10,"symbols":3,"payout":6000}],"ftw":91600}],"quests":{},"lvlData":{"level":5,"xpCur":2400,"xpTot":2600},"maxBet":6,"serverTime":1480527954.195072}""",
                        """{"freeSpinsCount":3,"chips":232040,"stages":[{"stage":"FreeSpin","field":[8,7,6,6,8,1,7,7,7,7,8,8,6,8,5],"lines":[],"ftw":91600}],"quests":{},"lvlData":{"level":5,"xpCur":2430,"xpTot":2600},"maxBet":6,"serverTime":1480527963.874301}""",
                        """{"freeSpinsCount":0,"chips":232840,"stages":[{"stage":"Respin","field":[7,3,2,6,8,5,1,6,2,4,8,7,5,9,3],"lines":[],"ftw":0}],"quests":{},"lvlData":{"level":5,"xpCur":2550,"xpTot":2600},"maxBet":6,"serverTime":1480527979.969305}"""
                        ]

            handler(parseJson(spins[spinNum]))
            inc spinNum
            if spinNum == spins.len: spinNum = 0
    elif slotMachineId == $candySlot:
        setTimeout 0.5, proc() =
            let regularSpin = """{"chips":5759750,"sca":0,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,10],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let bonusSpin = """{"chips":118800,"sca":0,"fc":0,"ftw":0,"bet":1000,"stages":[{"stage":"Spin","field":[2,7,2,3,2,7,8,9,7,8,8,5,10,8,9],"lines":[],"wi":[]},{"stage":"Bonus","field":[2,2,2],"dv":[15000,10000,20000],"payout":20000}],"quests":{},"lvlData":{"level":1,"xpCur":6,"xpTot":100},"maxBet":2,"serverTime":1484133005.600964}"""
            let freeSpinIntro1 = """{"chips":5759750,"sca":1,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,1],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let freeSpinIntro2 = """{"chips":5759750,"sca":2,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,1],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let freeSpinIntro3 = """{"chips":5759750,"sca":3,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,1],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let freeSpinIntro4 = """{"chips":5759750,"sca":4,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,1],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let freeSpinIntro5 = """{"chips":5759750,"sca":5,"fc":5,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,1],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let freeSpinOutro = """{"chips":5759750,"sca":0,"fc":0,"ftw":500,"bet":50,"stages":[{"stage":"FreeSpin","field":[2,4,4,3,8,7,8,9,7,4,8,10,8,8,10],"lines":[{"index":10,"symbols":3,"payout":500}],"wi":[]}],"quests":{},"lvlData":{"level":2,"xpCur":31,"xpTot":1800},"maxBet":3,"serverTime":1481213069.362561}"""
            let spinsRes = @[regularSpin, bonusSpin, freeSpinIntro1, freeSpinIntro2, freeSpinIntro3, freeSpinIntro4, freeSpinIntro5, freeSpinOutro]

            setTimeout 0.5, proc() =
                handler(parseJson(spinsRes[spinNum])) # Win
                inc spinNum
                if spinNum >= spinsRes.len:
                    spinNum = 0

    elif slotMachineId == $witchSlot:
        setTimeout 0.5, proc() =
            let regularSpin = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":612750,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[9,9,1,8,7,1,3,8,6,9,8,8,10,7,8],"lines":[{"index":8,"symbols":4,"payout":2000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":47,"xpTot":300},"maxBet":3,"serverTime":1500634045.946332}"""
            let bonusSpin1 = """{"pts":"11111","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":740800,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[4,4,5,4,3,8,6,10,3,10,9,10,4,10,4],"lines":[]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":55,"xpTot":300},"maxBet":3,"serverTime":1500887110.004374}"""
            let bonusSpin2 = """{"pts":"22222","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":735800,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[5,5,2,5,2,8,8,10,10,7,6,6,8,8,8],"lines":[{"index":16,"symbols":3,"payout":1000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":61,"xpTot":300},"maxBet":3,"serverTime":1500887292.597122}"""
            let bonusSpin3 = """{"pts":"33333","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":736800,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[2,3,4,2,4,7,9,7,8,10,9,7,10,6,9],"lines":[{"index":6,"symbols":4,"payout":2250}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":64,"xpTot":300},"maxBet":3,"serverTime":1500887381.749527}"""
            let bonusSpin4 = """{"pts":"44444","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":646750,"fc":0,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[5,7,6,9,10,7,8,7,8,1,3,2,3,3,5],"lines":[]},{"stage":"Bonus","field":[1,0,2,1,0,2,0,2,1,1,0,0,1,1,0,0,0,0,0,0,0,0,4,0,1,3],"payout":35000,"wbt":1000}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":48,"xpTot":300},"maxBet":3,"serverTime":1500637707.597658}"""
            let freeSpinIntro = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":735800,"fc":10,"ftw":0,"bet":50,"stages":[{"stage":"Spin","field":[6,9,6,10,1,10,10,1,9,8,8,6,8,1,9],"lines":[{"index":17,"symbols":3,"payout":1000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890639.727179}"""
            let freeSpin1 = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":735800,"fc":9,"ftw":0,"bet":50,"stages":[{"stage":"FreeSpin","field":[6,8,9,9,8,9,10,10,8,7,7,6,8,10,10],"lines":[]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890654.529977}"""
            let freeSpin2 = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":736800,"fc":8,"ftw":1000,"bet":50,"stages":[{"stage":"FreeSpin","field":[8,7,8,6,10,6,8,6,7,7,10,10,9,9,8],"lines":[{"index":9,"symbols":3,"payout":1000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890658.579853}"""
            let freeSpin3 = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":737800,"fc":8,"ftw":2000,"bet":50,"stages":[{"stage":"FreeSpin","field":[6,7,10,8,6,9,10,8,10,1,7,9,7,9,8],"lines":[{"index":18,"symbols":3,"payout":1000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890667.066619}"""
            let freeSpin4 = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":739800,"fc":7,"ftw":4000,"bet":50,"stages":[{"stage":"FreeSpin","field":[7,6,10,9,6,8,8,7,8,7,9,10,8,10,8],"lines":[{"index":16,"symbols":4,"payout":2000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890675.535039}"""
            let freeSpin5 = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":743900,"fc":6,"ftw":8100,"bet":50,"stages":[{"stage":"FreeSpin","field":[8,10,0,7,8,6,8,10,10,9,10,7,6,6,6],"lines":[{"index":9,"symbols":3,"payout":1000},{"index":19,"symbols":3,"payout":50}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890717.607179}"""
            let freeSpinOutro = """{"pts":"00000","pst":[3412,3421,4132,3412,2134],"isp":false,"chips":751850,"fc":0,"ftw":16050,"bet":50,"stages":[{"stage":"FreeSpin","field":[9,8,7,7,9,7,9,10,6,8,6,6,9,8,7],"lines":[{"index":3,"symbols":3,"payout":1000}]}],"quests":{"queseq":[],"questate":[],"stage":0,"stageTasks":[100000,100001,100002,100003,100004]},"lvlData":{"level":3,"xpCur":69,"xpTot":300},"maxBet":3,"serverTime":1500890789.368063}"""

            let spinsRes = @[regularSpin, bonusSpin1, bonusSpin2, bonusSpin3, bonusSpin4, freeSpinIntro, freeSpin1, freeSpin2, freeSpin3, freeSpin4, freeSpin5, freeSpinOutro]
            setTimeout 0.5, proc() =
                handler(parseJson(spinsRes[spinNum])) # Win
                inc spinNum
                if spinNum >= spinsRes.len:
                    spinNum = 0

    elif slotMachineId == $mermaidSlot:
        let regularSpin = """{"mp":[[4,0]],"chips":146000,"fc":0,"stages":[{"stage":"Spin","field":[5,12,10,5,11,11,8,4,6,5,8,1,3,9,2],"lines":[],"jackpot":false}],"quests":{"queseq":[],"questate":[65],"stage":1,"stageTasks":[100006,100007,100008,100009,100010]},"lvlData":{"level":3,"xpCur":30,"xpTot":250},"maxBet":2,"serverTime":1504029364.650701}"""
        let bonusSpin = """{"mp":[],"chips":222400,"fc":0,"stages":[{"stage":"Spin","field":[9,10,9,11,5,11,9,6,1,2,2,11,11,3,6],"lines":[],"jackpot":false},{"stage":"Bonus","field":[15000,40000,25000,15000,60000,25000,40000,25000,25000],"payout":80000}],"quests":{"queseq":[],"questate":[65],"stage":1,"stageTasks":[100006,100007,100008,100009,100010]},"lvlData":{"level":3,"xpCur":35,"xpTot":250},"maxBet":2,"serverTime":1504029417.574477}"""
        let freeSpinIntro = """{"mp":[],"chips":217400,"fc":5,"stages":[{"stage":"Spin","field":[10,9,12,11,7,12,11,8,1,12,1,6,7,3,1],"lines":[],"jackpot":false}],"quests":{"queseq":[],"questate":[65],"stage":1,"stageTasks":[100006,100007,100008,100009,100010]},"lvlData":{"level":3,"xpCur":40,"xpTot":250},"maxBet":2,"serverTime":1504029489.487152}"""
        let freeSpin5 = """{"mp":[[4,0],[1,2]],"chips":226200,"fc":5,"stages":[{"stage":"FreeSpin","field":[11,1,12,11,3,9,0,0,7,9,10,0,0,10,4],"lines":[{"index":6,"symbols":3,"payout":1000},{"index":21,"symbols":3,"payout":400}],"jackpot":false,"ftw":8800}],"quests":{"queseq":[],"questate":[65],"stage":1,"stageTasks":[100006,100007,100008,100009,100010]},"lvlData":{"level":3,"xpCur":40,"xpTot":250},"maxBet":2,"serverTime":1504029500.429843}"""
        let freeSpinOutro = """{"mp":[[4,0],[4,0]],"chips":363200,"fc":1,"stages":[{"stage":"FreeSpin","field":[12,12,7,10,12,8,4,8,11,10,4,3,11,7,11],"lines":[],"jackpot":false,"ftw":145800}],"quests":{"queseq":[],"questate":[65],"stage":1,"stageTasks":[100006,100007,100008,100009,100010]},"lvlData":{"level":3,"xpCur":40,"xpTot":250},"maxBet":2,"serverTime":1504029569.804614}"""
        let spinsRes = @[regularSpin, bonusSpin, freeSpinIntro, freeSpin5, freeSpinOutro]
        setTimeout 0.5, proc() =
            handler(parseJson(spinsRes[spinNum]))
            inc spinNum
            if spinNum >= spinsRes.len:
                spinNum = 0

    elif slotMachineId == $ufoSlot:
        var responses: seq[string] = @[]
        responses.add("""{"chips":42310158292,"fc":10,"stages":[{"stage":"Respin","meetIndex":7,"wildApears":[],"lines":[],"field":[5,11,11,7,7,10,8,0,10,8,8,5,6,4,4]}]}""")
        responses.add("""{"chips":42350358292,"fc":0,"stages":[{"stage":"Spin","lines":[],"field":[8,9,6,3,8,7,11,11,9,2,2,6,2,4,10]},{"stage":"Bonus","bonusData":{"payout":27000000,"sr":[{"field":[2,1,2,0,5,1,5,4,4],"fo":[[[3,0]],[[4,0]],[[7,0]]],"w":4500000,"d":false},{"field":[5,6,1,0,6,3,3,3,3],"fo":[[[3,0]],[[0,1]]],"w":3000000,"d":false},{"field":[2,3,4,0,3,5,3,3,1],"fo":[[[3,0]],[[4,0]],[[5,0]],[[8,0]]],"w":6000000,"d":false},{"field":[5,2,3,0,2,6,2,6,2],"fo":[[[3,0]],[[0,1],[4,0],[6,1]]],"w":6000000,"d":false},{"field":[5,6,4,0,2,3,1,1,1],"fo":[[[3,0]],[[0,1],[4,0],[6,0]],[[1,0]]],"w":7500000,"d":false}]},"payout":27000000}]}""")
        responses.add("""{"chips":42342858292,"fc":0,"stages":[{"stage":"Spin","lines":[],"field":[8,8,3,4,8,7,10,2,7,10,5,9,9,5,6]}]}""")
        responses.add("""{"chips":42342858292,"fc":0,"stages":[{"stage":"Spin","lines":[],"field":[8,8,3,4,8,7,10,2,7,10,5,9,9,5,6]}]}""")

        setTimeout 0.5, proc() =
            handler(parseJson(responses[spinNum]))
            inc spinNum
            if spinNum >= responses.len:
                spinNum = 0

    elif slotMachineId == $groovySlot:
        var responses: seq[string] = @[]
        responses.add("""{"chips":1051200,"sfc":0,"bfc":0,"fc":0,"sfp":1,"bfp":0,"rc":1,"stages":[{"stage":"Spin","field":[5,9,4,8,4,6,2,10,3,9,7,10,2,0,10],"lines":[],"sftw":0,"bftw":0,"ftw":0}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263250,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":1000,"hardBet":0},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525190143.011205}""")
        responses.add("""{"chips":1121200,"sfc":0,"bfc":0,"fc":0,"sfp":2,"bfp":0,"rc":2,"stages":[{"stage":"Respin","field":[5,9,1,2,10,6,5,5,3,4,7,6,6,10,9],"lines":[{"index":0,"symbols":3,"payout":5000},{"index":2,"symbols":3,"payout":5000},{"index":3,"symbols":3,"payout":5000},{"index":4,"symbols":2,"payout":2000},{"index":6,"symbols":3,"payout":5000},{"index":8,"symbols":3,"payout":5000},{"index":9,"symbols":2,"payout":2000},{"index":10,"symbols":3,"payout":5000},{"index":12,"symbols":3,"payout":5000},{"index":13,"symbols":3,"payout":5000},{"index":14,"symbols":3,"payout":5000},{"index":15,"symbols":2,"payout":2000},{"index":16,"symbols":3,"payout":5000},{"index":17,"symbols":2,"payout":2000},{"index":20,"symbols":3,"payout":5000},{"index":21,"symbols":3,"payout":5000},{"index":24,"symbols":2,"payout":2000}],"sftw":0,"bftw":0,"ftw":0}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263250,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":1000,"hardBet":0},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525190147.102134}""")
        responses.add("""{"chips":1173200,"sfc":10,"bfc":0,"fc":10,"sfp":3,"bfp":0,"rc":3,"stages":[{"stage":"Respin","field":[5,9,1,2,3,6,5,0,3,2,7,6,3,10,7],"lines":[{"index":0,"symbols":3,"payout":5000},{"index":2,"symbols":2,"payout":2000},{"index":3,"symbols":2,"payout":2000},{"index":4,"symbols":2,"payout":2000},{"index":6,"symbols":3,"payout":5000},{"index":8,"symbols":3,"payout":5000},{"index":9,"symbols":2,"payout":2000},{"index":10,"symbols":2,"payout":2000},{"index":12,"symbols":2,"payout":2000},{"index":13,"symbols":3,"payout":5000},{"index":14,"symbols":3,"payout":5000},{"index":15,"symbols":2,"payout":2000},{"index":16,"symbols":2,"payout":2000},{"index":17,"symbols":2,"payout":2000},{"index":20,"symbols":3,"payout":5000},{"index":21,"symbols":2,"payout":2000},{"index":24,"symbols":2,"payout":2000}],"sftw":0,"bftw":0,"ftw":0}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263250,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":1000,"hardBet":10},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525190170.622984}""")
        responses.add("""{"chips":1227200,"sfc":10,"bfc":0,"fc":10,"sfp":0,"bfp":0,"rc":0,"stages":[{"stage":"FreeSpin","field":[8,2,2,4,5,6,8,1,9,10,2,7,7,7,4],"lines":[{"index":6,"symbols":2,"payout":2000},{"index":12,"symbols":4,"payout":30000},{"index":22,"symbols":3,"payout":20000},{"index":24,"symbols":2,"payout":2000}],"sftw":54000,"bftw":0,"ftw":54000}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263250,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":1000,"hardBet":9},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525190179.693223}""")
        responses.add("""{"chips":1356200,"sfc":9,"bfc":0,"fc":9,"sfp":0,"bfp":0,"rc":0,"stages":[{"stage":"FreeSpin","field":[0,1,4,9,6,4,7,8,6,2,3,2,5,8,10],"lines":[{"index":3,"symbols":5,"payout":125000},{"index":9,"symbols":2,"payout":2000},{"index":13,"symbols":2,"payout":2000}],"sftw":183000,"bftw":0,"ftw":183000}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263250,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":1000,"hardBet":8},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525190187.319955}""")
        responses.add("""{"chips":1592200,"sfc":0,"bfc":0,"fc":0,"sfp":0,"bfp":0,"rc":0,"stages":[{"stage":"Spin","field":[1,2,2,8,4,4,8,9,1,10,9,1,4,10,3],"lines":[],"sftw":0,"bftw":0,"ftw":0}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263450,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":2000,"hardBet":0},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525195979.128564}""")
        responses.add("""{"chips":1592200,"sfc":0,"bfc":0,"fc":0,"sfp":0,"bfp":0,"rc":0,"stages":[{"stage":"Spin","field":[1,2,2,8,4,4,8,9,1,10,9,1,4,10,3],"lines":[],"sftw":0,"bftw":0,"ftw":0}],"quests":{"queseq":[],"questate":[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,7],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000},"balloonSlot":{"s":1,"q":100002},"ufoSlot":{"s":1,"q":100005},"candySlot":{"s":1,"q":100001},"witchSlot":{"s":1,"q":100003},"mermaidSlot":{"s":1,"q":100004}}},"lvlData":{"level":60,"xpCur":5263450,"xpTot":758500},"exchangeNum":{"cc":0,"cp":0},"cronTime":1525248000.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":2000,"hardBet":0},"maxBet":15,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1525248000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1525195979.128564}""")
        setTimeout 0.5, proc() =
            handler(parseJson(responses[spinNum]))
            inc spinNum
            if spinNum >= responses.len:
                spinNum = 0

    elif slotMachineId == $candySlot2:
        var responses: seq[string] = @[]
        responses.add("""{"chips":36806800,"fc":0,"ftw":0,"bet":50000,"stages":[{"stage":"Spin","field":[9,9,9,8,9,4,7,5,5,5,7,5,8,9,7],"lines":[{"index":1,"symbols":3,"payout":12500}]}],"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":9,"xpCur":5325,"xpTot":5550},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529136000.0,"betsConf":{"allBets":[5000,10000,25000,50000],"servBet":2500,"hardBet":0},"maxBet":4,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529136000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529066204.100076}""")
        responses.add("""{"chips":37356800,"fc":0,"ftw":0,"bet":50000,"stages":[{"stage":"Spin","field":[4,9,8,9,10,8,3,7,1,9,7,2,2,10,2],"lines":[]},{"stage":"Bonus","field":[30,20,20],"payout":600000}],"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":9,"xpCur":5375,"xpTot":5550},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529136000.0,"betsConf":{"allBets":[5000,10000,25000,50000],"servBet":2500,"hardBet":0},"maxBet":4,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529136000.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529067409.904338}""")
        responses.add("""{"chips":135921571,"fc":4,"ftw":0,"bet":5000,"stages":[{"stage":"Spin","field":[3,10,3,9,1,9,1,8,10,9,1,9,7,6,10],"lines":[]}],"quests":{"queseq":[{"r":[{"t":"cc","c":10000},{"t":"cb","c":5},{"t":"x","c":10}],"s":2,"t":[{"t":"AA","o":"noBuilding","p":[{"cp":1,"tp":1,"pi":0}],"m":0}],"i":1,"k":1,"skipPrice":0},{"r":[{"t":"cp","c":500}],"s":1,"t":[{"t":"bb","o":"candySlot2","p":[{"cp":0,"tp":25,"pi":0}],"m":2,"s":"FreeSpin"}],"i":100003,"k":0,"skipPrice":50}],"questate":[64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,2],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001},"groovySlot":{"s":1,"q":100002},"candySlot2":{"s":0,"q":100003}}},"lvlData":{"level":39,"xpCur":40150,"xpTot":97980},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529654400.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":250,"hardBet":4},"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529587164.086575}""")
        responses.add("""{"chips":135942321,"fc":4,"ftw":20750,"bet":5000,"stages":[{"stage":"FreeSpin","field":[10,0,0,8,0,9,7,9,5,9,7,10,10,0,6],"lines":[{"index":1,"symbols":3,"payout":750},{"index":4,"symbols":3,"payout":5000},{"index":5,"symbols":5,"payout":7500},{"index":11,"symbols":3,"payout":1250},{"index":17,"symbols":5,"payout":6250}],"wi":[1,2,13],"wac":4}],"quests":{"queseq":[{"r":[{"t":"cc","c":10000},{"t":"cb","c":5},{"t":"x","c":10}],"s":2,"t":[{"t":"AA","o":"noBuilding","p":[{"cp":1,"tp":1,"pi":0}],"m":0}],"i":1,"k":1,"skipPrice":0},{"r":[{"t":"cp","c":500}],"s":1,"t":[{"t":"bb","o":"candySlot2","p":[{"cp":3,"tp":25,"pi":0}],"m":2,"s":"FreeSpin"}],"i":100003,"k":0,"skipPrice":50}],"questate":[64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,2],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001},"groovySlot":{"s":1,"q":100002},"candySlot2":{"s":0,"q":100003}}},"lvlData":{"level":39,"xpCur":40150,"xpTot":97980},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529654400.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":250,"hardBet":3},"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529587176.895424}""")
        responses.add("""{"chips":135961071,"fc":3,"ftw":39500,"bet":5000,"stages":[{"stage":"FreeSpin","field":[8,0,3,10,7,3,7,0,0,0,9,5,7,7,10],"lines":[{"index":5,"symbols":3,"payout":7500},{"index":7,"symbols":3,"payout":2500},{"index":11,"symbols":3,"payout":7500},{"index":19,"symbols":3,"payout":1250}],"wi":[1,7,8],"wac":9}],"quests":{"queseq":[{"r":[{"t":"cc","c":10000},{"t":"cb","c":5},{"t":"x","c":10}],"s":2,"t":[{"t":"AA","o":"noBuilding","p":[{"cp":1,"tp":1,"pi":0}],"m":0}],"i":1,"k":1,"skipPrice":0},{"r":[{"t":"cp","c":500}],"s":1,"t":[{"t":"bb","o":"candySlot2","p":[{"cp":6,"tp":25,"pi":0}],"m":2,"s":"FreeSpin"}],"i":100003,"k":0,"skipPrice":50}],"questate":[64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,2],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001},"groovySlot":{"s":1,"q":100002},"candySlot2":{"s":0,"q":100003}}},"lvlData":{"level":39,"xpCur":40150,"xpTot":97980},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529654400.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":250,"hardBet":2},"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529587201.614159}""")
        responses.add("""{"chips":135977571,"fc":2,"ftw":56000,"bet":5000,"stages":[{"stage":"FreeSpin","field":[6,10,9,9,10,10,7,10,0,0,0,9,0,10,8],"lines":[{"index":2,"symbols":3,"payout":1250},{"index":5,"symbols":5,"payout":6250},{"index":10,"symbols":4,"payout":7500},{"index":18,"symbols":3,"payout":750},{"index":19,"symbols":3,"payout":750}],"wi":[10,12,8],"wac":9}],"quests":{"queseq":[{"r":[{"t":"cc","c":10000},{"t":"cb","c":5},{"t":"x","c":10}],"s":2,"t":[{"t":"AA","o":"noBuilding","p":[{"cp":1,"tp":1,"pi":0}],"m":0}],"i":1,"k":1,"skipPrice":0},{"r":[{"t":"cp","c":500}],"s":1,"t":[{"t":"bb","o":"candySlot2","p":[{"cp":9,"tp":25,"pi":0}],"m":2,"s":"FreeSpin"}],"i":100003,"k":0,"skipPrice":50}],"questate":[64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,2],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001},"groovySlot":{"s":1,"q":100002},"candySlot2":{"s":0,"q":100003}}},"lvlData":{"level":39,"xpCur":40150,"xpTot":97980},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529654400.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":250,"hardBet":1},"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529587220.532682}""")
        responses.add("""{"chips":136002571,"fc":1,"ftw":81000,"bet":5000,"stages":[{"stage":"FreeSpin","field":[0,6,8,9,8,7,8,7,7,7,8,0,0,10,0],"lines":[{"index":2,"symbols":3,"payout":2500},{"index":3,"symbols":3,"payout":2500},{"index":4,"symbols":3,"payout":2500},{"index":6,"symbols":3,"payout":5000},{"index":9,"symbols":3,"payout":2500},{"index":10,"symbols":3,"payout":2500},{"index":12,"symbols":3,"payout":5000},{"index":17,"symbols":3,"payout":2500}],"wi":[0,11,12],"wac":14}],"quests":{"queseq":[{"r":[{"t":"cc","c":10000},{"t":"cb","c":5},{"t":"x","c":10}],"s":2,"t":[{"t":"AA","o":"noBuilding","p":[{"cp":1,"tp":1,"pi":0}],"m":0}],"i":1,"k":1,"skipPrice":0},{"r":[{"t":"cp","c":500}],"s":1,"t":[{"t":"bb","o":"candySlot2","p":[{"cp":12,"tp":25,"pi":0}],"m":2,"s":"Spin"}],"i":100003,"k":0,"skipPrice":50}],"questate":[64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,0,0,2],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001},"groovySlot":{"s":1,"q":100002},"candySlot2":{"s":0,"q":100003}}},"lvlData":{"level":39,"xpCur":40150,"xpTot":97980},"exchangeNum":{"cc":0,"cp":0},"cronTime":1529654400.0,"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":15000,"hardBet":0},"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529587245.347679}""")
        setTimeout 0.5, proc() =
            handler(parseJson(responses[spinNum]))
            inc spinNum
            if spinNum >= responses.len:
                spinNum = 0

    elif slotMachineId == $cardSlot:
        var responses: seq[string] = @[]

        responses.add("""{"chips":95250,"fc":0,"ftw":0,"bet":5000,"lmt":1,"wfr":true,"stages":[{"stage":"Spin","field":[8,7,11,6,3,7,3,4,5,6,4,5,5,8,11],"hdn":[],"cft":"NoFreespin","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":0},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":15,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534946456.430218}""")
        responses.add("""{"chips":196250,"fc":10,"ftw":0,"bet":5000,"lmt":1,"wfr":true,"stages":[{"stage":"Spin","field":[11,3,8,2,11,4,5,11,6,4,8,8,4,1,5],"hdn":[],"cft":"Multiplier","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":0},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000}}},"lvlData":{"level":1,"xpCur":5,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534950393.439997}""")
        responses.add("""{"chips":196250,"fc":3,"ftw":0,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[7,8,6,1,6,4,7,1,1,7,1,4,8,1,4],"hdn":[3,8],"cft":"Hidden","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":10},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000}}},"lvlData":{"level":1,"xpCur":5,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534950412.043548}""")
        responses.add("""{"chips":208750,"fc":2,"ftw":12500,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[1,6,1,5,7,6,5,1,2,4,7,1,1,1,2],"hdn":[0,2,7],"cft":"Hidden","lines":[{"index":17,"symbols":4,"payout":12500}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":9},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000}}},"lvlData":{"level":1,"xpCur":5,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534950420.528101}""")
        responses.add("""{"chips":236250,"fc":1,"ftw":40000,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[6,6,8,6,6,6,7,6,7,7,6,3,2,2,6],"hdn":[0,5,10,14],"cft":"Hidden","lines":[{"index":5,"symbols":3,"payout":1250},{"index":7,"symbols":3,"payout":1250},{"index":19,"symbols":5,"payout":25000}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":8},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000}}},"lvlData":{"level":1,"xpCur":5,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534950436.504568}""")
        responses.add("""{"chips":196250,"fc":10,"ftw":0,"bet":5000,"lmt":1,"wfr":true,"stages":[{"stage":"Spin","field":[11,3,8,2,11,4,5,11,6,4,8,8,4,1,5],"hdn":[],"cft":"Multiplier","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":0},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":1,"q":100000}}},"lvlData":{"level":1,"xpCur":5,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534950393.439997}""")
        responses.add("""{"chips":374000,"fc":3,"ftw":0,"bet":5000,"lmt":2,"wfr":false,"stages":[{"stage":"FreeSpin","field":[8,3,4,4,8,6,2,3,0,3,5,1,10,3,6],"hdn":[],"cft":"Multiplier","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":10},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":15,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535536969.026085}""")
        responses.add("""{"chips":379000,"fc":2,"ftw":5000,"bet":5000,"lmt":2,"wfr":false,"stages":[{"stage":"FreeSpin","field":[2,5,10,8,6,5,6,2,4,7,6,8,5,0,4],"hdn":[],"cft":"Multiplier","lines":[{"index":4,"symbols":3,"payout":2500},{"index":11,"symbols":3,"payout":2500}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":9},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":15,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535536980.094307}""")
        responses.add("""{"chips":391500,"fc":1,"ftw":17500,"bet":5000,"lmt":5,"wfr":false,"stages":[{"stage":"FreeSpin","field":[6,3,4,7,7,4,5,10,6,8,3,8,5,5,6],"hdn":[],"cft":"Multiplier","lines":[{"index":19,"symbols":3,"payout":12500}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":8},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":15,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535536998.465457}""")
        responses.add("""{"chips":499000,"fc":10,"ftw":0,"bet":5000,"lmt":1,"wfr":true,"stages":[{"stage":"Spin","field":[11,3,8,2,11,4,5,11,6,4,8,8,4,1,5],"hdn":[],"cft":"Multiplier","lines":[]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":0},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":20,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535537561.059397}""")
        responses.add("""{"chips":500250,"fc":3,"ftw":1250,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[4,2,5,7,3,8,6,6,8,7,6,7,3,4,8],"hdn":[],"cft":"Shuffle","lines":[{"index":14,"symbols":3,"payout":1250}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":10},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":20,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535537577.571376}""")
        responses.add("""{"chips":534000,"fc":2,"ftw":35000,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[0,6,2,4,5,6,4,6,7,6,5,3,4,6,3],"hdn":[],"cft":"Shuffle","lines":[{"index":3,"symbols":3,"payout":2500},{"index":5,"symbols":5,"payout":25000},{"index":7,"symbols":4,"payout":6250}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":9},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":20,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535537590.618556}""")
        responses.add("""{"chips":540250,"fc":1,"ftw":41250,"bet":5000,"lmt":1,"wfr":false,"stages":[{"stage":"FreeSpin","field":[1,6,7,7,4,5,2,6,6,1,4,5,5,5,8],"hdn":[],"cft":"Shuffle","lines":[{"index":12,"symbols":4,"payout":6250}]}],"betsConf":{"allBets":[5000],"servBet":250,"hardBet":8},"quests":{"queseq":[],"questate":[],"slotQuests":{"dreamTowerSlot":{"s":2,"q":100001}}},"lvlData":{"level":1,"xpCur":20,"xpTot":25},"exchangeNum":{"cc":0,"cp":0},"cronTime":0.0,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1535537608.502287}""")

        setTimeout 0.5, proc() =
            handler(parseJson(responses[spinNum]))
            inc spinNum
            if spinNum >= responses.len:
                spinNum = 0

method getStore*(s: StubServer, handler: proc(r: JsonNode)) =
    setTimeout 1.5, proc() =
        let resp = """
            {"items":[{"id":1,"name":"Dream Tower","description":"Slot with classic spin mechanics and Wild symbol. Scatter symbols give Free Spins. Bonus symbols activate Restaurant Bonus Game.","kind":0,"levels":[{"buildPrice":500,"buildTime":140.0,"fromLevel":0}]},{"id":2,"name":"Windy Day","description":"Slot with avalanche spin method, Re-spin feature, Bonus Game with win multipliers, more free spin rounds can be won in Free Spins mode.","kind":0,"levels":[{"buildPrice":1000,"buildTime":600.0,"fromLevel":0}]},{"id":4,"name":"UFO","description":"UFO Slot","kind":0,"levels":[{"buildPrice":1000,"buildTime":4020.0,"fromLevel":0}]},{"id":6,"name":"Candy Shop","description":"Slot with original spin mechanics. Wild turns other symbols to Wilds. Scatters give Free spins. Bonus symbols activate Bonus Game.","kind":0,"levels":[{"buildPrice":1000,"buildTime":660.0,"fromLevel":0}]},{"id":3,"name":"Restaurant","description":"Building which produces resources, gives you some amount of Chips for a period of time.","kind":1,"levels":[{"buildPrice":800,"buildTime":200.0,"fromLevel":1},{"buildPrice":1000,"buildTime":800.0,"fromLevel":4},{"buildPrice":1200,"buildTime":1800.0,"fromLevel":8}]},{"id":9,"name":"Gas Station","description":"Building produces resources, gives you some amount of Bucks for a period of time.","kind":1,"levels":[{"buildPrice":800,"buildTime":250.0,"fromLevel":2},{"buildPrice":1000,"buildTime":1000.0,"fromLevel":6},{"buildPrice":1200,"buildTime":2250.0,"fromLevel":10}]},{"id":0,"name":"City Hall","description":"Bla-bla-bla","kind":2,"levels":[{"buildPrice":200,"buildTime":300.0,"fromLevel":1},{"buildPrice":300,"buildTime":1200.0,"fromLevel":2},{"buildPrice":500,"buildTime":2700.0,"fromLevel":4},{"buildPrice":800,"buildTime":4800.0,"fromLevel":7},{"buildPrice":1100,"buildTime":7500.0,"fromLevel":10},{"buildPrice":1400,"buildTime":10800.0,"fromLevel":13},{"buildPrice":2000,"buildTime":14700.0,"fromLevel":19},{"buildPrice":2300,"buildTime":19200.0,"fromLevel":22},{"buildPrice":2600,"buildTime":24300.0,"fromLevel":25},{"buildPrice":2900,"buildTime":30000.0,"fromLevel":28},{"buildPrice":3200,"buildTime":36300.0,"fromLevel":31},{"buildPrice":3500,"buildTime":43200.0,"fromLevel":34},{"buildPrice":3800,"buildTime":50700.0,"fromLevel":37},{"buildPrice":4100,"buildTime":58800.0,"fromLevel":40},{"buildPrice":4400,"buildTime":67500.0,"fromLevel":43}]},{"id":5,"name":"Facebook","description":"Facebook Door","kind":2,"levels":[{"buildPrice":100,"buildTime":640.0,"fromLevel":0}]}],"serverTime":1480615426.81013}"""
        handler(parseJson(resp))

method purchaseLogic*(s: StubServer, targetLogic: string, info: JsonNode = nil, handler: proc(r: JsonNode) = nil) =
    if targetLogic == "getStoreData":
        setTimeout 0.5, proc() =
            let resp = """
                 {"store_config":{"display_order":["b7","b8","b9","b4","b5","b6"],"best_seller":"b2","best_price":"b5","special":"b6","chips_offer":"b7","bucks_offer":"b8"},"product_bundles":[{"id":"b3","name":"Big Pack","usdPrice":"25","products":[{"currency":"Bucks","amount":6000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b3"},{"id":"b1","name":"Start Pack","usdPrice":"5","products":[{"currency":"Bucks","amount":600}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b1"},{"id":"b2","name":"Light Pack","usdPrice":"15","products":[{"currency":"Bucks","amount":3000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b2"},{"id":"b6","name":"Special Pack","usdPrice":"10","products":[{"currency":"Bucks","amount":750},{"currency":"Chips","amount":2000000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b6"},{"id":"b8","name":"Bucks Pack","usdPrice":"4","products":[{"currency":"Bucks","amount":1000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b8"},{"id":"b9","name":"Energy Pack","usdPrice":"10","products":[{"currency":"Energy","amount":20000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b9"},{"id":"b7","name":"Chips Pack","usdPrice":"2","products":[{"currency":"Chips","amount":1000000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b7"},{"id":"b4","name":"Pro Pack","usdPrice":"50","products":[{"currency":"Bucks","amount":15000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b4"},{"id":"b5","name":"Mega Pack","usdPrice":"100","products":[{"currency":"Bucks","amount":40000}],"url":"https://stage-api.onsetgame.com/stage-master/purchases/fbproduct/b5"}],"offers_data":[]}
                """
            handler(parseJson(resp))

# method getMap*(s: StubServer, handler: proc(r: JsonNode)) =
#     setTimeout 1.5, proc() =
#         let resp = """
#              {"id":"58406601f262000000000050","rev":"58406601f262000000000051","rev_time":1480615425.231491,"spots":[{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":1480615425.231491,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":1480615425.231491,"size":0},{"opened":0.0,"size":0},{"opened":1480615425.231491,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":0.0,"size":0},{"opened":1480615425.231491,"size":0,"buildItem":{"id":0,"level":0,"upgradeEndTime":0.0}}],"map_state":{"vip_level":0,"level":0,"vip_invest_sum":0,"warehouse":{"items":[]}},"serverTime":1480615425.23449}""" %
#             [$epochTime()]
#         handler(parseJson(resp))

method getMode*(s: StubServer, slotMachineId: string, mode: JsonNode, handler: proc(r: JsonNode)) =
    spinNum = 0
    setTimeout 1.5, proc() =
        var resp: string

        if slotMachineId == $dreamTowerSlot:
            resp = """{"bmt":[10,15,25], "lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1],[1,2,1,0,1],[0,1,1,1,0],[2,1,1,1,2],[0,1,0,1,0],[2,1,2,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,0,2,0,0],[2,2,0,2,2],[0,2,2,2,0]],"chips":100000,"lvlData":{"level":1,"xpCur":0,"xpTot":1000},"bets":[1000,5000],"maxBet":2,"serverTime":1480605236.222248}"""
        elif slotMachineId == $balloonSlot:
            resp = """{"bmt":[8,11,13], "freeSpinsCount":0,"bet":40,"stages":[{"field":[9,6,9,3,5,7,8,8,6,8,6,9,5,2,7],"stage":"Spin","ftw":0}],"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,0,0,1],[1,2,2,2,1],[0,1,0,1,0],[2,1,2,1,2],[0,2,2,2,0],[2,0,0,0,2],[1,0,1,2,1],[1,2,1,0,1],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[0,1,1,1,0],[2,1,1,1,2],[2,0,2,0,2],[2,0,1,0,2],[0,2,1,2,0],[1,0,2,0,1],[1,2,0,2,1]],"chips":3259240,"lvlData":{"level":10,"xpCur":4530,"xpTot":19200},"bets":[1000,5000,10000,20000,50000,100000,200000,500000,1000000],"maxBet":9,"serverTime":1480449785.982106}"""
        elif slotMachineId == $candySlot:
            resp = """{"bmt":[9,11,13], "sca":0,"fc":0,"ftw":45750,"stb":1250,"bet":250,"cs":null,"cn":null,"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2]],"paytable":{"items":["wild","scatter","bonus","cake1","cake2","cake3","cake4","candy1","candy2","candy3","candy4"],"table":[[100,0,0,100,100,75,75,50,40,30,25],[50,0,0,50,50,40,40,30,25,20,15],[30,0,0,30,30,25,25,20,10,5,3],[0,0,0,0,0,0,0,0,0,0,0]],"freespin_count":5,"bonus_multipliers":[5,10,15]},"chips":1732750,"lvlData":{"level":5,"xpCur":106,"xpTot":400},"bets":[5000,10000,25000],"maxBet":3,"serverTime":1516703049.107246}"""
        elif slotMachineId == $witchSlot:
            resp = """{"bmt":[9,11,14], "pst":[2341,4321,3412,2143,1342],"psc":0,"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2]],"paytable":{"items":["Wild","Scatter","Red","Yellow","Green","Blue","Plant","Mandragora","Mushroom","Feather","Web"],"table":[[0,0,500,500,500,500,175,150,125,100,10],[0,0,100,100,100,100,50,45,40,35,6],[0,0,30,30,30,30,25,20,15,10,2],[0,0,0,0,0,0,0,0,0,0,0]],"freespin_count":10, "magic_spin_chance":20,"bonus_start_elements":8,"bonus_elements_paytable":[[2,5,10,15,25,40],[4,10,20,30,50,80],[6,15,30,45,75,120],[8,20,40,60,100,160],[10,25,50,75,125,200]]},"chips":100000,"lvlData":{"level":1,"xpCur":0,"xpTot":25},"bets":[5000],"maxBet":1,"serverTime":1516883922.628486}"""
        elif slotMachineId == $mermaidSlot:
            resp = """{"bmt":[10,13,15], "lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2],[0,2,1,2,0],[0,2,2,2,0],[2,0,0,0,2],[1,0,2,0,1],[1,2,0,2,1]],"chips":100000,"lvlData":{"level":1,"xpCur":0,"xpTot":25},"bets":[5000],"maxBet":1,"serverTime":1504027414.03378}"""
        elif slotMachineId == $ufoSlot:
            resp = """{"bmt":[10,15,25], "fc":0,"ftw":0,"bet":150000,"cs":null,"cn":null,"wp":null,"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0]],"paytable":{"items":["1","2","3","4","5","6","7","8","9","10","11","12"],"table":[[0,0,0,500,400,300,200,150,150,125,125,125],[0,0,0,80,70,60,50,30,30,25,25,25],[0,0,0,25,20,15,10,5,5,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0]],"freespinsAllCount":10,"freespinsAdditionalCount":2,"bonusSpins":5},"chips":42348858292,"lvlData":{"level":60,"xpCur":430600,"xpTot":758500},"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"servBet":75000,"hardBet":0},"bets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000,400000,500000,750000,1000000,1500000],"maxBet":15,"serverTime":1518101227.309309}"""
        elif slotMachineId == $groovySlot:
            resp = """{"sfc":0,"sftw":0,"sfp":0,"bfc":0,"bftw":0,"bfp":0,"fc":0,"swr":[false,false,false,false,false],"bet":200,"cs":null,"cn":null,"bmt":[10,15,25],"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2],[0,2,1,2,0],[0,2,2,2,0],[2,0,0,0,2],[1,0,2,0,1],[1,2,0,2,1]],"paytable":{"items":["wild","lemon","cherry","melon","grape","7red","7green","7blue","3bar","2bar","1bar","7wild","7any"],"table":[[0,250,250,250,250,125,125,125,150,100,50,0,125],[0,50,50,50,50,30,30,30,30,20,10,0,30],[0,20,20,20,20,5,5,5,15,10,5,5,5],[0,0,0,0,0,0,0,0,0,0,0,0,2]],"barsFreespinTrigger":2,"totalBarsFreespinCount":10,"barsPayout":[0,0,0,0,1,2,5,10,15,20,30,50,100,200,500,1000],"sevensInReelTrigger":3,"sevensFreespinTrigger":3,"totalSevensFreespinCount":10},"chips":1081200}"""
        elif slotMachineId == $candySlot2:
            resp = """{"fc":0,"ftw":5670000,"bet":15000,"cs":null,"cn":null,"bmt":[8,10,12],"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2]],"paytable":{"items":["wild","scatter","bonus","cake1","cake2","cake3","cake4","candy1","candy2","candy3","candy4"],"table":[[100,0,0,100,100,75,75,50,40,30,25],[50,0,0,50,50,40,40,30,25,20,15],[30,0,0,30,30,25,25,20,10,5,3],[0,0,0,0,0,0,0,0,0,0,0]],"freespins_relation":{"3":4,"4":5,"5":6},"bonus_relation":{"3":1,"4":2,"5":3},"bonus_possible_multipliers":[1.2,1.5,2.0,3.0]},"chips":130996571,"lvlData":{"level":39,"xpCur":29645,"xpTot":97980},"betsConf":{"allBets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"servBet":15000,"hardBet":0},"bets":[5000,10000,25000,50000,75000,100000,150000,200000,250000,300000],"maxBet":10,"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"nextDiscountedExchange":1529654400.0,"exchangeChips":0,"giftsCount":0,"serverTime":1529582981.852041}"""
        elif slotMachineId == $cardSlot:
            resp = """{"psc":0,"bmt":[10,13,17],"lines":[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[1,0,1,2,1],[1,2,1,0,1],[0,0,1,2,2],[2,2,1,0,0],[0,1,0,1,0],[2,1,2,1,2],[1,0,0,0,1],[1,2,2,2,1],[0,1,1,1,0],[2,1,1,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[2,0,1,0,2]],"paytable":{"items":["wild","big1","big2","big3","big4","low1","low2","low3","low4","hidden","feature","scatter"],"table":[[0,200,150,125,125,100,100,75,75,0,0,0],[0,50,40,30,30,25,25,20,20,0,0,0],[0,20,15,10,10,5,5,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]]},"chips":102750,"lvlData":{"level":1,"xpCur":5,"xpTot":25},"betsConf":{"allBets":[5000],"servBet":250,"hardBet":0},"maintenanceTime":0.0,"prevFreeSpin":0.0,"freeSpinTimeout":86400.0,"freeSpinsLeft":0,"nextDiscountedExchange":0.0,"exchangeChips":0,"giftsCount":0,"serverTime":1534946282.773559}"""

        var jresp = parseJson(resp)
        jresp["betsConf"] = %*{"allBets":[5000], "servBet":1000, "hardBet":0}
        handler(jresp)

method exchangeBucks*(s: StubServer, cTo: Currency, handler: proc(r: JsonNode) = nil) =
    setTimeout 1.1, proc() =
        let resp = """{"status": 0, "chips": 2000, "bucks": 500, "parts": 200}"""
        handler(parseJson(resp))
